@page "/AssetFileAdd"

@using NuGetPackageManagerApp.AppCode
@using NuGetPackageManagerWebApp.AppCode.CustomNuGetV2;
@using System.ComponentModel.DataAnnotations;

@inject NavigationManager _nav
@inject NuGetFileServiceV2 _nugetFileService

<h3>Add Asset File and Packages</h3>
<div>
    <EditForm Model="@Model" OnValidSubmit="Submit" FormName="myEditForm">
        <DataAnnotationsValidator />
        <ValidationSummary />
        <div>
            <label>
                Project or Solution Name:
                <InputText @bind-Value="Model!.ProjectSolutionName" />
            </label>
        </div>
        <div>
            <label>
                Path:
                <InputText @bind-Value="Model!.Path" />
            </label>
        </div>
        <div>
            <label>
                Is it a Solution asset.json file?
                <InputCheckbox @bind-Value="Model!.IsSolution" />
            </label>
        </div>
        <button type="Submit">Submit</button>
        <button type="button" @onclick="Cancel">Cancel</button>
    </EditForm>
</div>


@code {
    [SupplyParameterFromForm]
    private newAssetFile? Model { get; set; }

    protected override async Task OnInitializedAsync()
    {
        Model ??= new();
    }

    private async Task Submit()
    {
        var output = await _nugetFileService.AddNewAssetsFile(Model!.ProjectSolutionName, Model!.IsSolution ? "Solution" : "Project", Model!.Path);
        _nav.NavigateTo("/test");
    }

    private void Cancel()
    {
        _nav.NavigateTo("/showEverything");
    }


    private class newAssetFile
    {
        [Required]
        public string ProjectSolutionName { get; set; } = "";

        [Required]
        public string Path { get; set; } = "";

        [Required]
        public bool IsSolution { get; set; } = false;
    }
}
